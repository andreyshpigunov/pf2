PF2. Концепция и стили кодирования
==================================

Берем библиотеку PF, убираем все лишнее, добавляем полезное. :) Стараемся сохранить совместимость с первой версией для одноименных классов.

## Папки, файлы и импорты

* Код классов кладем в папку /lib.
* Документация в /docs. Формат документов — Markdown.
* Кодировка файлов библиотеки и request:charset — utf-8. Расширение файлов с кодом — «.p», шаблонов — «.pt».
* Классы группируем в пакеты для минимизации количества файловых операций.
* Импортируем файлы по абсолютным именам (pf2/lib/common.p).

## Стиль кодирования и имён

Стиль кодирования только для кода самой библиотеки. Код, который использует классы может использовать любой стиль кодирования и наименования идентификаторов.

### Отступы и пробелы

* Горизонтальные отступы в коде — два пробела. Табуляция запрещена.
* Вертикальный отступ — одна пустая строка.
* Удаляем концевые пробелы во всех строках. В конце файла обязательно оставляем пустую строку.

### Идентификаторы

* Для названий классов, функций, переменных и свойств используем «camel case» (вотТакойВерблюд).
* Названия всех классов начинаем с префикса «pf» (pfSomeClass).
* Константы пишем прописными буквами и разделяем слова подчеркиваниями (CONNECT_STRING).
* Приватные переменные, методы и константы начинаем с подчеркивания (_privateField).
* Доступ к приватным переменным делаем через свойства. Свойства нельзя делать приватными.
* Идентификаторы для метапрограммирования начинаем с двух подчеркивания. Можно ими же и закончить.

### Функции

* Аргументы функции начинаем с префикса «a» (aArg).
* Обязательные параметры ставим в начало списка аргументов. Необязательные группируем в хеш и ставим последним параметром с именем aOptions. Если необязательный параметр только один, то его  ставим первым аргументом функции.
* Если аргумент ожидает код, то завершаем его суффиксом «Code» (aCode, aElseCode).
* Тело функции отделяем вертикальным отступом от левого края.
* Если функция содержит локальные переменные, то добавляем в объявление функции locals. Локальные переменные начинаем с префикса «l».
* self используем только для записи в контекст объекта. Имена полей, аргументов и локальных переменных не должны совпадать, чего и не должно происходить, если мы используем префиксы.

### Комментарии

* Комментарии к коду только строчные (те, что начинаются с решетки). ^rem используем только для временного комментирования блоков кода.
* Описания классов, методов и существенные комментария в коде начинаем с двух решеток. Так они лучше заметны в коде и могут быть использованы системой автодокументирования.
* Комментарии пишем на отдельных строках внутри структур. В классах после @CLASS, в методах после определения функции.
* Копирайты помещаем в начало файла.
* Описание аргумента функции начинаем с имени. Необязательные параметры пишем через точку после имени аргумента (aOptions.param).

## Система контроля версий

* Используем Mercurial (hg)
* Релизная ветка — default. В нее напрямую ничего не комитим.
* Ветка разработки — develop.
* Сложные и неоднозначные фичи пилим в ветках feature/name/subname. :)
